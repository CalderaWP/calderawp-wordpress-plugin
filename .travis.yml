sudo: required
dist: trusty

language: php
node_js:
- "8"
php:
- 7.1

cache:
  yarn: true
  directories:
  - node_modules
  - vendor


env:
- NODE_RELEASE=8.x

before_install:
- sudo rm -rf ~/.nvm - curl -sL "https://deb.nodesource.com/setup_${NODE_RELEASE}" | sudo -E bash -
- sudo apt-get install -y nodejs

install:
- composer install
- yarn


stages:
- unit
- integration
- coverage
#- deploy

jobs:
  include:
  - stage: unit
    script: yarn test:once
  - # stage name not required, will continue to use `unit`
    script: composer test:unit
  - stage: integration
    script: composer wp:install
  - # stage name not required, will continue to use `integration`
    script: composer test:unit
  - stage: coverage
    script: COVERALLS_REPO_TOKEN=$COVERALLS_TOKEN
  - # stage name not required, will continue to use `coverage`
    script: yarn test:coverage-report


